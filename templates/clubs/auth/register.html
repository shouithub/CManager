{% extends 'clubs/base.html' %}

{% block title %}用户注册{% endblock %}

{% block extra_css %}
<style>
    .auth-container {
        min-height: calc(100vh - 80px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--md3-spacing-2xl) var(--md3-spacing-lg) 120px;
    }
    
    .auth-card {
        width: 100%;
        max-width: 640px;
        padding: var(--md3-spacing-2xl);
    }
    
    .auth-header {
        text-align: center;
        margin-bottom: var(--md3-spacing-xl);
    }
    
    .auth-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto var(--md3-spacing-md);
        background: var(--md3-primary-container);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .auth-icon .material-icons {
        font-size: 2rem;
        color: var(--md3-primary);
    }
    
    .auth-title {
        font-size: 1.5rem;
        font-weight: 500;
        color: var(--md3-on-surface);
        margin: 0 0 var(--md3-spacing-xs) 0;
    }
    
    .auth-subtitle {
        font-size: 0.875rem;
        color: var(--md3-on-surface-variant);
        margin: 0;
    }
    
    .auth-divider {
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-md);
        margin: var(--md3-spacing-xl) 0;
        color: var(--md3-on-surface-variant);
        font-size: 0.875rem;
    }
    
    .auth-divider::before,
    .auth-divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: var(--md3-outline-variant);
    }
    
    .auth-link {
        text-align: center;
        font-size: 0.875rem;
        color: var(--md3-on-surface-variant);
        margin-top: var(--md3-spacing-lg);
    }
    
    .auth-link a {
        font-weight: 500;
    }
    
    /* Message styling */
    .message-container {
        margin-bottom: var(--md3-spacing-lg);
    }
    
    .message {
        padding: var(--md3-spacing-md);
        border-radius: var(--md3-radius-md);
        font-size: 0.875rem;
        display: flex;
        align-items: flex-start;
        gap: var(--md3-spacing-sm);
        margin-bottom: var(--md3-spacing-sm);
        line-height: 1.5;
    }
    
    .message.error {
        background: var(--md3-error-container);
        color: var(--md3-on-error-container);
    }
    
    .message.info {
        background: var(--md3-secondary-container);
        color: var(--md3-on-secondary-container);
    }
    
    .message .material-icons {
        font-size: 1.25rem;
        flex-shrink: 0;
        margin-top: 2px;
    }
    
    .form-hint {
        font-size: 0.75rem;
        color: var(--md3-on-surface-variant);
        margin-top: var(--md3-spacing-xs);
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="card auth-card">
        <div class="auth-header">
            <div class="auth-icon">
                <span class="material-icons">person_add</span>
            </div>
            <h1 class="auth-title">用户注册</h1>
            <p class="auth-subtitle">欢迎来到系统，请填写以下信息注册</p>
        </div>
        
        {% if errors %}
        <div class="message-container">
            {% for error in errors %}
            <div class="message error">
                <span class="material-icons">error_outline</span>
                <span>{{ error }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="message-container">
            <div class="message info">
                <span class="material-icons">info</span>
                <span>请注册等待管理员审核，社长注册请直接登录</span>
            </div>
        </div>

        <form method="post" class="auth-form" id="registerForm">
            {% csrf_token %}
            
            <!-- 用户名 & 姓名 -->
            <div class="grid-2">
                <div class="form-group">
                    <label for="username">用户名 *</label>
                    <input type="text" id="username" name="username" 
                           value="{{ form_data.username }}" placeholder="请输入用户名" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="real_name">真实姓名 *</label>
                    <input type="text" id="real_name" name="real_name" 
                           value="{{ form_data.real_name }}" placeholder="请输入真实姓名" required>
                </div>
            </div>

            <!-- 邮箱 -->
            <div class="form-group">
                <label for="email">邮箱 *</label>
                <input type="email" id="email" name="email" 
                       value="{{ form_data.email }}" placeholder="请输入邮箱地址" required autocomplete="email">
                <div class="form-hint">用于接收系统通知</div>
            </div>

            <!-- 密码 -->
            <div class="grid-2">
                <div class="form-group">
                    <label for="password">密码 *</label>
                    <input type="password" id="password" name="password" 
                           placeholder="请输入密码" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="password_confirm">确认密码 *</label>
                    <input type="password" id="password_confirm" name="password_confirm" 
                           placeholder="请再次输入密码" required autocomplete="new-password">
                </div>
            </div>

            <!-- 角色选择 -->
            <div class="form-group">
                <label for="role">角色 *</label>
                <select id="role" name="role" required>
                    <option value="">请选择角色</option>
                    <option value="president" {% if form_data.role == 'president' %}selected{% endif %}>社长</option>
                    <option value="staff" {% if form_data.role == 'staff' %}selected{% endif %}>干事</option>
                </select>
            </div>

            <!-- 学号 & 政治面貌 -->
            <div class="grid-2">
                <div class="form-group">
                    <label for="student_id">学号 *</label>
                    <input type="text" id="student_id" name="student_id" 
                           value="{{ form_data.student_id }}" placeholder="请输入学号" required>
                </div>
                <div class="form-group">
                    <label for="political_status">政治面貌</label>
                    <select id="political_status" name="political_status">
                        <option value="">请选择政治面貌</option>
                        <option value="communist_party_member" {% if form_data.political_status == 'communist_party_member' %}selected{% endif %}>中共党员</option>
                        <option value="communist_party_probationary" {% if form_data.political_status == 'communist_party_probationary' %}selected{% endif %}>中共预备党员</option>
                        <option value="communist_youth_league" {% if form_data.political_status == 'communist_youth_league' %}selected{% endif %}>共青团员</option>
                        <option value="revolutionary_committee" {% if form_data.political_status == 'revolutionary_committee' %}selected{% endif %}>民革党员</option>
                        <option value="china_democratic_league" {% if form_data.political_status == 'china_democratic_league' %}selected{% endif %}>民盟盟员</option>
                        <option value="democratic_national_construction" {% if form_data.political_status == 'democratic_national_construction' %}selected{% endif %}>民建会员</option>
                        <option value="china_peasants_workers_democratic" {% if form_data.political_status == 'china_peasants_workers_democratic' %}selected{% endif %}>农工党党员</option>
                        <option value="china_council_for_promoting" {% if form_data.political_status == 'china_council_for_promoting' %}selected{% endif %}>致公党党员</option>
                        <option value="jiusanshe" {% if form_data.political_status == 'jiusanshe' %}selected{% endif %}>九三学社社员</option>
                        <option value="taiwan_democratic_self_government" {% if form_data.political_status == 'taiwan_democratic_self_government' %}selected{% endif %}>台盟盟员</option>
                        <option value="non_party_personage" {% if form_data.political_status == 'non_party_personage' %}selected{% endif %}>无党派人士</option>
                        <option value="progressive" {% if form_data.political_status == 'progressive' %}selected{% endif %}>入党积极分子</option>
                        <option value="non_member" {% if form_data.political_status == 'non_member' %}selected{% endif %}>群众</option>
                    </select>
                </div>
            </div>

            <!-- 部门选择（仅干事） -->
            <div class="form-group" id="department-container" style="display: none;">
                <label for="department">部门 *</label>
                <select id="department" name="department">
                    <option value="">请选择部门</option>
                    {% for dept in departments %}
                    <option value="{{ dept.id }}" {% if form_data.department == dept.id|stringformat:"s" %}selected{% endif %}>{{ dept.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- 电话 & 微信 -->
            <div class="grid-2">
                <div class="form-group">
                    <label for="phone">电话 *</label>
                    <input type="tel" id="phone" name="phone" 
                           value="{{ form_data.phone }}" placeholder="请输入电话号码" required autocomplete="tel">
                </div>
                <div class="form-group">
                    <label for="wechat">微信 *</label>
                    <input type="text" id="wechat" name="wechat" 
                           value="{{ form_data.wechat }}" placeholder="请输入微信号" required>
                </div>
            </div>

            <button type="submit" class="btn btn-filled btn-block btn-lg" style="margin-top: var(--md3-spacing-md);">
                <span class="material-icons">person_add</span>
                创建账户
            </button>
        </form>

        <div class="auth-link">
            已有账户？ <a href="{% url 'clubs:login' %}">立即登录</a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const roleSelect = document.getElementById('role');
    const politicalStatusSelect = document.getElementById('political_status');
    const departmentContainer = document.getElementById('department-container');
    const departmentSelect = document.getElementById('department');
    
    function updateRequirements() {
        const isPresident = roleSelect.value === 'president';
        const isStaff = roleSelect.value === 'staff';
        
        // 社长必须选择政治面貌
        politicalStatusSelect.required = isPresident;
        // 如果是社长且未选择政治面貌，添加星号提示（这里通过label text不好动态改，但required属性已设置）
        
        // 干事必须选择部门
        if (isStaff) {
            departmentContainer.style.display = 'block';
            departmentSelect.required = true;
        } else {
            departmentContainer.style.display = 'none';
            departmentSelect.required = false;
        }
    }
    
    roleSelect.addEventListener('change', updateRequirements);
    
    // 初始化
    updateRequirements();
});
</script>
{% endblock %}