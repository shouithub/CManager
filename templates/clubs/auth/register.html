{% extends 'clubs/base.html' %}

{% block title %}用户注册{% endblock %}

{% block extra_css %}
<style>
    .register-page {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--md3-spacing-2xl);
        background: var(--md3-surface);
    }
    
    .register-card {
        width: 100%;
        max-width: 500px;
        background: var(--md3-surface-container-lowest);
        border-radius: var(--md3-radius-2xl);
        padding: var(--md3-spacing-3xl) var(--md3-spacing-2xl);
        border: 1px solid var(--md3-outline-variant);
        box-shadow: var(--md3-elevation-3);
    }
    
    .register-header {
        text-align: center;
        margin-bottom: var(--md3-spacing-2xl);
    }
    
    .register-logo {
        width: 80px;
        height: 80px;
        margin: 0 auto var(--md3-spacing-lg);
        background: var(--md3-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--md3-elevation-2);
    }
    
    .register-logo .material-icons {
        font-size: 2.5rem;
        color: var(--md3-on-primary);
    }
    
    .register-title {
        font-size: 1.75rem;
        font-weight: 500;
        color: var(--md3-on-surface);
        margin: 0 0 var(--md3-spacing-xs) 0;
        letter-spacing: 0;
    }
    
    .register-subtitle {
        font-size: 1rem;
        color: var(--md3-on-surface-variant);
        margin: 0;
    }
    
    /* 错误和信息框 */
    .error-box, .info-box {
        border-radius: var(--md3-radius-xl);
        padding: var(--md3-spacing-lg);
        margin-bottom: var(--md3-spacing-xl);
    }
    
    .error-box {
        background: var(--md3-error-container);
        border: 1px solid var(--md3-error);
    }
    
    .info-box {
        background: var(--md3-secondary-container);
        border: 1px solid var(--md3-secondary);
    }
    
    .error-item, .info-item {
        display: flex;
        align-items: flex-start;
        gap: var(--md3-spacing-sm);
        font-size: 0.875rem;
        line-height: 1.5;
    }
    
    .error-item {
        color: var(--md3-on-error-container);
    }
    
    .info-item {
        color: var(--md3-on-secondary-container);
    }
    
    .error-item + .error-item,
    .info-item + .info-item {
        margin-top: var(--md3-spacing-sm);
    }
    
    .error-item .material-icons {
        font-size: 1.125rem;
        color: var(--md3-error);
        flex-shrink: 0;
        margin-top: 1px;
    }
    
    .info-item .material-icons {
        font-size: 1.125rem;
        color: var(--md3-secondary);
        flex-shrink: 0;
        margin-top: 1px;
    }
    
    /* 表单样式 */
    .register-form {
        display: flex;
        flex-direction: column;
        gap: var(--md3-spacing-lg);
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--md3-spacing-lg);
    }
    
    /* Material Design 3 输入框 */
    .md3-field {
        position: relative;
        display: flex;
        flex-direction: column;
    }
    
    .md3-field-input, .md3-field-select {
        width: 100%;
        height: 56px;
        padding: 16px;
        padding-top: 24px;
        border: 1px solid var(--md3-outline);
        border-radius: var(--md3-radius-sm);
        font-size: 1rem;
        background: var(--md3-surface);
        color: var(--md3-on-surface);
        font-family: inherit;
        transition: all 0.2s ease;
        box-sizing: border-box;
    }
    
    .md3-field-input:focus, .md3-field-select:focus {
        outline: none;
        border-color: var(--md3-primary);
        border-width: 2px;
        padding: 15px;
        padding-top: 23px;
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--md3-primary) 20%, transparent);
    }
    
    .md3-field-input::placeholder {
        color: transparent;
    }
    
    .md3-field-label {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1rem;
        color: var(--md3-on-surface-variant);
        pointer-events: none;
        transition: all 0.2s ease;
        background: var(--md3-surface);
        padding: 0 4px;
        z-index: 1;
    }
    
    .md3-field-input:focus + .md3-field-label,
    .md3-field-input:not(:placeholder-shown) + .md3-field-label {
        top: 0;
        font-size: 0.75rem;
        color: var(--md3-primary);
        font-weight: 500;
    }
    
    .md3-field-input:not(:focus):not(:placeholder-shown) + .md3-field-label {
        color: var(--md3-on-surface-variant);
    }
    
    .md3-field-hint {
        font-size: 0.75rem;
        color: var(--md3-on-surface-variant);
        margin-top: var(--md3-spacing-xs);
        padding-left: 16px;
        line-height: 1.4;
    }
    
    /* Select 特殊样式 */
    .md3-field-select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%2349454F' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 24px;
    }
    
    /* 提交按钮 */
    .btn-submit {
        width: 100%;
        height: 48px;
        margin-top: var(--md3-spacing-lg);
        background: var(--md3-primary);
        color: var(--md3-on-primary);
        border: none;
        border-radius: var(--md3-radius-full);
        font-size: 0.875rem;
        font-weight: 500;
        letter-spacing: 0.1px;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: var(--md3-elevation-1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--md3-spacing-xs);
    }
    
    .btn-submit:hover {
        box-shadow: var(--md3-elevation-2);
        background: color-mix(in srgb, var(--md3-primary) 85%, var(--md3-on-primary));
    }
    
    .btn-submit:active {
        transform: scale(0.98);
    }
    
    /* 页脚 */
    .register-footer {
        margin-top: var(--md3-spacing-2xl);
        text-align: center;
    }
    
    .register-footer p {
        font-size: 0.875rem;
        color: var(--md3-on-surface-variant);
        margin: 0;
    }
    
    .register-footer a {
        color: var(--md3-primary);
        text-decoration: none;
        font-weight: 500;
        transition: text-decoration 0.2s ease;
    }
    
    .register-footer a:hover {
        text-decoration: underline;
    }
    
    /* 响应式 */
    @media (max-width: 620px) {
        .register-page {
            padding: var(--md3-spacing-lg);
            align-items: flex-start;
            padding-top: var(--md3-spacing-xl);
            padding-bottom: 120px;
        }
        
        .register-card {
            padding: var(--md3-spacing-2xl) var(--md3-spacing-xl);
            border-radius: var(--md3-radius-xl);
        }
        
        .register-logo {
            width: 64px;
            height: 64px;
        }
        
        .register-logo .material-icons {
            font-size: 2rem;
        }
        
        .register-title {
            font-size: 1.5rem;
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="register-page">
    <div class="register-card">
        <div class="register-header">
            <div class="register-logo">
                <span class="material-icons">badge</span>
            </div>
            <h1 class="register-title">用户注册</h1>
            <p class="register-subtitle">欢迎来到系统，注册/登录</p>
        </div>
        
        {% if errors %}
        <div class="error-box">
            {% for error in errors %}
            <div class="error-item">
                <span class="material-icons">error_outline</span>
                <span>{{ error }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="info-box">
            <div class="info-item">
                <span class="material-icons">info</span>
                <span>请注册等待管理员审核，社长注册请直接登录</span>
            </div>
        </div>

        <form method="post" class="register-form" id="registerForm">
            {% csrf_token %}
            
            <!-- 用户名 & 姓名 -->
            <div class="form-row">
                <div class="md3-field">
                    <input type="text" class="md3-field-input" id="username" name="username" 
                           value="{{ form_data.username }}" placeholder=" " required autocomplete="username">
                    <label class="md3-field-label" for="username">用户名 *</label>
                </div>
                <div class="md3-field">
                    <input type="text" class="md3-field-input" id="real_name" name="real_name" 
                           value="{{ form_data.real_name }}" placeholder=" " required>
                    <label class="md3-field-label" for="real_name">真实姓名 *</label>
                </div>
            </div>

            <!-- 邮箱 -->
            <div class="md3-field">
                <input type="email" class="md3-field-input" id="email" name="email" 
                       value="{{ form_data.email }}" placeholder=" " autocomplete="email">
                <label class="md3-field-label" for="email">邮箱</label>
                <div class="md3-field-hint">用于接收系统通知（可选）</div>
            </div>

            <!-- 密码 -->
            <div class="form-row">
                <div class="md3-field">
                    <input type="password" class="md3-field-input" id="password" name="password" 
                           placeholder=" " required autocomplete="new-password">
                    <label class="md3-field-label" for="password">密码 *</label>
                </div>
                <div class="md3-field">
                    <input type="password" class="md3-field-input" id="password_confirm" name="password_confirm" 
                           placeholder=" " required autocomplete="new-password">
                    <label class="md3-field-label" for="password_confirm">确认密码 *</label>
                </div>
            </div>

            <!-- 角色选择 -->
            <div class="md3-field">
                <select class="md3-field-select" id="role" name="role" required>
                    <option value="">请选择角色 *</option>
                    <option value="president" {% if form_data.role == 'president' %}selected{% endif %}>社长</option>
                    <option value="staff" {% if form_data.role == 'staff' %}selected{% endif %}>干事</option>
                </select>
            </div>

            <!-- 学号 & 政治面貌 -->
            <div class="form-row">
                <div class="md3-field">
                    <input type="text" class="md3-field-input" id="student_id" name="student_id" 
                           value="{{ form_data.student_id }}" placeholder=" " required>
                    <label class="md3-field-label" for="student_id">学号 *</label>
                </div>
                <div class="md3-field">
                    <select class="md3-field-select" id="political_status" name="political_status">
                        <option value="">政治面貌</option>
                        <option value="communist_party_member" {% if form_data.political_status == 'communist_party_member' %}selected{% endif %}>中共党员</option>
                        <option value="communist_party_probationary" {% if form_data.political_status == 'communist_party_probationary' %}selected{% endif %}>中共预备党员</option>
                        <option value="communist_youth_league" {% if form_data.political_status == 'communist_youth_league' %}selected{% endif %}>共青团员</option>
                        <option value="revolutionary_committee" {% if form_data.political_status == 'revolutionary_committee' %}selected{% endif %}>民革党员</option>
                        <option value="china_democratic_league" {% if form_data.political_status == 'china_democratic_league' %}selected{% endif %}>民盟盟员</option>
                        <option value="democratic_national_construction" {% if form_data.political_status == 'democratic_national_construction' %}selected{% endif %}>民建会员</option>
                        <option value="china_peasants_workers_democratic" {% if form_data.political_status == 'china_peasants_workers_democratic' %}selected{% endif %}>农工党党员</option>
                        <option value="china_council_for_promoting" {% if form_data.political_status == 'china_council_for_promoting' %}selected{% endif %}>致公党党员</option>
                        <option value="jiusanshe" {% if form_data.political_status == 'jiusanshe' %}selected{% endif %}>九三学社社员</option>
                        <option value="taiwan_democratic_self_government" {% if form_data.political_status == 'taiwan_democratic_self_government' %}selected{% endif %}>台盟盟员</option>
                        <option value="non_party_personage" {% if form_data.political_status == 'non_party_personage' %}selected{% endif %}>无党派人士</option>
                        <option value="progressive" {% if form_data.political_status == 'progressive' %}selected{% endif %}>入党积极分子</option>
                        <option value="non_member" {% if form_data.political_status == 'non_member' %}selected{% endif %}>群众</option>
                    </select>
                </div>
            </div>

            <!-- 部门选择（仅干事） -->
            <div class="md3-field" id="department-container" style="display: none;">
                <select class="md3-field-select" id="department" name="department">
                    <option value="">请选择部门 *</option>
                    {% for dept in departments %}
                    <option value="{{ dept.id }}" {% if form_data.department == dept.id|stringformat:"s" %}selected{% endif %}>{{ dept.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- 电话 & 微信 -->
            <div class="form-row">
                <div class="md3-field">
                    <input type="tel" class="md3-field-input" id="phone" name="phone" 
                           value="{{ form_data.phone }}" placeholder=" " required autocomplete="tel">
                    <label class="md3-field-label" for="phone">电话 *</label>
                </div>
                <div class="md3-field">
                    <input type="text" class="md3-field-input" id="wechat" name="wechat" 
                           value="{{ form_data.wechat }}" placeholder=" " required>
                    <label class="md3-field-label" for="wechat">微信 *</label>
                </div>
            </div>

            <button type="submit" class="btn-submit">
                <span class="material-icons">person_add</span>
                创建账户
            </button>
        </form>

        <div class="register-footer">
            <p>已有账户？<a href="{% url 'clubs:login' %}">登录</a></p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const roleSelect = document.getElementById('role');
    const politicalStatusSelect = document.getElementById('political_status');
    const departmentContainer = document.getElementById('department-container');
    const departmentSelect = document.getElementById('department');
    
    function updateRequirements() {
        const isPresident = roleSelect.value === 'president';
        const isStaff = roleSelect.value === 'staff';
        
        // 社长必须选择政治面貌
        politicalStatusSelect.required = isPresident;
        
        // 干事必须选择部门
        if (isStaff) {
            departmentContainer.style.display = 'flex';
            departmentSelect.required = true;
        } else {
            departmentContainer.style.display = 'none';
            departmentSelect.required = false;
        }
    }
    
    roleSelect.addEventListener('change', updateRequirements);
    
    // 初始化
    updateRequirements();
});
</script>
{% endblock %}
