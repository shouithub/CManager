{% extends 'clubs/base.html' %}

{% block title %}ç”¨æˆ·ç®¡ç†{% endblock %}

{% block extra_css %}
<style>
    .users-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--md3-spacing-2xl);
        box-sizing: border-box;
    }
    
    /* é¡µé¢æ ‡é¢˜ */
    .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--md3-spacing-md);
        margin-bottom: var(--md3-spacing-2xl);
        padding: var(--md3-spacing-2xl);
        background: linear-gradient(135deg, var(--md3-primary-container) 0%, var(--md3-tertiary-container) 100%);
        border-radius: var(--md3-radius-xl);
        box-shadow: var(--md3-elevation-1);
    }
    
    .header-content {
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-md);
    }
    
    .header-content .material-icons {
        font-size: 2.5rem;
        color: var(--md3-primary);
    }
    
    .header-text h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 600;
        color: var(--md3-on-surface);
    }
    
    .header-text p {
        margin: var(--md3-spacing-xs) 0 0 0;
        font-size: 0.875rem;
        color: var(--md3-on-surface-variant);
    }
    
    .stats-badge {
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-sm);
        padding: var(--md3-spacing-md) var(--md3-spacing-lg);
        background: var(--md3-surface-container);
        border-radius: var(--md3-radius-full);
        font-weight: 600;
        color: var(--md3-primary);
        box-shadow: var(--md3-elevation-1);
    }
    
    .stats-badge .material-icons {
        font-size: 1.25rem;
    }
    
    /* æœç´¢å¡ç‰‡ */
    .search-card {
        background: var(--md3-surface-container);
        border-radius: var(--md3-radius-xl);
        padding: var(--md3-spacing-2xl);
        margin-bottom: var(--md3-spacing-xl);
        border: 1px solid var(--md3-outline-variant);
        box-shadow: var(--md3-elevation-1);
    }
    
    .search-form {
        display: grid;
        grid-template-columns: 2fr 1fr auto;
        gap: var(--md3-spacing-md);
        align-items: center;
    }
    
    .form-input,
    .form-select {
        padding: var(--md3-spacing-md) var(--md3-spacing-lg);
        background: var(--md3-surface-container-highest);
        border: 1px solid var(--md3-outline);
        border-radius: var(--md3-radius-md);
        font-family: inherit;
        font-size: 1rem;
        color: var(--md3-on-surface);
        transition: all 0.2s ease;
    }
    
    .form-input:focus,
    .form-select:focus {
        outline: none;
        border-color: var(--md3-primary);
        box-shadow: 0 0 0 3px var(--md3-primary-container);
    }
    
    .form-input::placeholder {
        color: var(--md3-on-surface-variant);
    }
    
    .btn-search {
        display: inline-flex;
        align-items: center;
        gap: var(--md3-spacing-sm);
        padding: var(--md3-spacing-md) var(--md3-spacing-xl);
        background: var(--md3-primary);
        color: var(--md3-on-primary);
        border: none;
        border-radius: var(--md3-radius-full);
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    
    .btn-search:hover {
        background: var(--md3-primary-dim);
        box-shadow: var(--md3-elevation-2);
    }
    
    .btn-search .material-icons {
        font-size: 1.25rem;
    }
    
    /* è¡¨æ ¼å¡ç‰‡ */
    .table-card {
        background: var(--md3-surface-container);
        border-radius: var(--md3-radius-xl);
        border: 1px solid var(--md3-outline-variant);
        box-shadow: var(--md3-elevation-1);
        overflow: hidden;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .data-table thead {
        background: var(--md3-surface-container-high);
        border-bottom: 2px solid var(--md3-outline-variant);
    }
    
    .data-table th {
        padding: var(--md3-spacing-lg);
        text-align: left;
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--md3-on-surface-variant);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .data-table tbody tr {
        border-bottom: 1px solid var(--md3-outline-variant);
        transition: background-color 0.2s ease;
    }
    
    .data-table tbody tr:last-child {
        border-bottom: none;
    }
    
    .data-table tbody tr:hover {
        background: var(--md3-surface-container-highest);
    }
    
    .data-table td {
        padding: var(--md3-spacing-lg);
        font-size: 0.875rem;
        color: var(--md3-on-surface);
    }
    
    .data-table td strong {
        font-weight: 600;
        color: var(--md3-on-surface);
    }
    
    /* è§’è‰²å¾½ç«  */
    .role-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--md3-spacing-xs);
        padding: var(--md3-spacing-xs) var(--md3-spacing-md);
        border-radius: var(--md3-radius-full);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .role-badge.president {
        background: var(--md3-primary-container);
        color: var(--md3-on-primary-container);
    }
    
    .role-badge.staff {
        background: var(--md3-tertiary-container);
        color: var(--md3-on-tertiary-container);
    }
    
    .role-badge.admin {
        background: var(--md3-error-container);
        color: var(--md3-on-error-container);
    }
    
    .role-badge.unknown {
        background: var(--md3-surface-container-highest);
        color: var(--md3-on-surface-variant);
    }
    
    /* çŠ¶æ€å¾½ç«  */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--md3-spacing-xs);
        padding: var(--md3-spacing-xs) var(--md3-spacing-sm);
        border-radius: var(--md3-radius-full);
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .status-badge.pending {
        background: var(--md3-warning-container);
        color: var(--md3-on-warning-container);
    }
    
    .status-badge.approved {
        background: var(--md3-success-container);
        color: var(--md3-on-success-container);
    }
    
    .status-badge.rejected {
        background: var(--md3-error-container);
        color: var(--md3-on-error-container);
    }
    
    .status-badge.unknown {
        background: var(--md3-surface-container-high);
        color: var(--md3-on-surface-variant);
    }
    
    .status-badge .material-icons {
        font-size: 1rem;
    }
    
    /* æ“ä½œæŒ‰é’® */
    .action-buttons {
        display: flex;
        gap: var(--md3-spacing-sm);
        flex-wrap: wrap;
    }
    
    .btn-action {
        display: inline-flex;
        align-items: center;
        gap: var(--md3-spacing-xs);
        padding: var(--md3-spacing-sm) var(--md3-spacing-md);
        border-radius: var(--md3-radius-md);
        font-size: 0.75rem;
        font-weight: 600;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    
    .btn-action .material-icons {
        font-size: 1rem;
    }
    
    .btn-action.review {
        background: var(--md3-warning-container);
        color: var(--md3-on-warning-container);
    }
    
    .btn-action.review:hover {
        background: var(--md3-warning);
        box-shadow: var(--md3-elevation-1);
    }
    
    .btn-action.detail {
        background: var(--md3-primary-container);
        color: var(--md3-on-primary-container);
    }
    
    .btn-action.detail:hover {
        background: var(--md3-primary);
        color: var(--md3-on-primary);
        box-shadow: var(--md3-elevation-1);
    }
    
    /* ç©ºçŠ¶æ€ */
    .empty-state {
        background: var(--md3-surface-container);
        border-radius: var(--md3-radius-xl);
        padding: var(--md3-spacing-3xl);
        text-align: center;
        border: 1px solid var(--md3-outline-variant);
    }
    
    .empty-state .material-icons {
        font-size: 4rem;
        color: var(--md3-on-surface-variant);
        opacity: 0.5;
        margin-bottom: var(--md3-spacing-md);
    }
    
    .empty-state p {
        margin: 0;
        font-size: 1rem;
        color: var(--md3-on-surface-variant);
    }
    
    /* å“åº”å¼ */
    @media (max-width: 768px) {
        .users-container {
            padding: var(--md3-spacing-lg);
        }
        
        .page-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .header-content {
            flex-direction: column;
            text-align: center;
            width: 100%;
        }
        
        .stats-badge {
            width: 100%;
            justify-content: center;
        }
        
        .search-form {
            grid-template-columns: 1fr;
        }
        
        .table-card {
            overflow-x: auto;
        }
        
        .data-table {
            min-width: 1000px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="users-container">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
        <div class="header-content">
            <span class="material-icons">group</span>
            <div class="header-text">
                <h1>ç³»ç»Ÿç”¨æˆ·ç®¡ç†</h1>
                <p>ç®¡ç†æ‰€æœ‰ç”¨æˆ·è´¦æˆ·å’Œæƒé™</p>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: var(--md3-spacing-md);">
            <a href="{% url 'clubs:create_user' %}" class="btn-action detail" style="padding: var(--md3-spacing-md) var(--md3-spacing-xl); font-size: 0.875rem;">
                <span class="material-icons">person_add</span>
                åˆ›å»ºç”¨æˆ·
            </a>
            <div class="stats-badge">
                <span class="material-icons">person</span>
                <span>{{ total_users }} ä¸ªç”¨æˆ·</span>
            </div>
        </div>
    </div>
    
    <!-- æœç´¢è¿‡æ»¤ -->
    <div class="search-card">
        <form method="get" class="search-form">
            <input 
                type="text" 
                name="search" 
                class="form-input"
                placeholder="ğŸ” æœç´¢ç”¨æˆ·åã€é‚®ç®±..." 
                value="{{ search }}"
            >
            <select name="role" class="form-select">
                <option value="">æ‰€æœ‰è§’è‰²</option>
                <option value="president" {% if role == 'president' %}selected{% endif %}>ç¤¾é•¿</option>
                <option value="staff" {% if role == 'staff' %}selected{% endif %}>å¹²äº‹</option>
                <option value="admin" {% if role == 'admin' %}selected{% endif %}>ç®¡ç†å‘˜</option>
            </select>
            <button type="submit" class="btn-search">
                <span class="material-icons">search</span>
                æœç´¢
            </button>
        </form>
    </div>
    
    <!-- ç”¨æˆ·åˆ—è¡¨ -->
    {% if users %}
    <div class="table-card">
        <table class="data-table">
            <thead>
                <tr>
                    <th>ç”¨æˆ·å</th>
                    <th>é‚®ç®±</th>
                    <th>å…¨å</th>
                    <th>ç”µè¯</th>
                    <th>å¾®ä¿¡</th>
                    <th>æ”¿æ²»é¢è²Œ</th>
                    <th>è§’è‰²</th>
                    <th>çŠ¶æ€</th>
                    <th>åŠ å…¥æ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td><strong>{{ user.username }}</strong></td>
                    <td>{{ user.email|default:"--" }}</td>
                    <td>{{ user.profile.get_full_name|default:"--" }}</td>
                    <td>{{ user.profile.phone|default:"--" }}</td>
                    <td>{{ user.profile.wechat|default:"--" }}</td>
                    <td>
                        {% if user.profile.role == 'president' or user.profile.role == 'staff' %}
                            {{ user.profile.get_political_status_display|default:"æœªå¡«å†™" }}
                        {% else %}
                            --
                        {% endif %}
                    </td>
                    <td>
                        {% if user.profile.role == 'president' %}
                            <span class="role-badge president">ç¤¾é•¿</span>
                        {% elif user.profile.role == 'staff' %}
                            <span class="role-badge staff">å¹²äº‹</span>
                        {% elif user.profile.role == 'admin' %}
                            <span class="role-badge admin">ç®¡ç†å‘˜</span>
                        {% else %}
                            <span class="role-badge unknown">æœªè®¾å®š</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if user.profile.role == 'staff' %}
                            {% if user.profile.status == 'pending' %}
                                <span class="status-badge pending">
                                    <span class="material-icons">schedule</span>
                                    å¾…å®¡æ ¸
                                </span>
                            {% elif user.profile.status == 'approved' %}
                                <span class="status-badge approved">
                                    <span class="material-icons">check_circle</span>
                                    å·²æ‰¹å‡†
                                </span>
                            {% elif user.profile.status == 'rejected' %}
                                <span class="status-badge rejected">
                                    <span class="material-icons">cancel</span>
                                    å·²æ‹’ç»
                                </span>
                            {% else %}
                                <span class="status-badge unknown">æœªçŸ¥</span>
                            {% endif %}
                        {% else %}
                            <span class="status-badge approved">
                                <span class="material-icons">check_circle</span>
                                å·²æ¿€æ´»
                            </span>
                        {% endif %}
                    </td>
                    <td>{{ user.date_joined|date:"Y-m-d" }}</td>
                    <td>
                        <div class="action-buttons">
                            {% if user.profile.role == 'staff' and user.profile.status == 'pending' %}
                                <a href="{% url 'clubs:admin_review' user.id %}?type=staff_registration" class="btn-action review">
                                    <span class="material-icons">assignment</span>
                                    å®¡æ ¸
                                </a>
                            {% endif %}

                            {% if user.profile.role == 'staff' %}
                                <a href="{% url 'clubs:change_staff_attributes' user.id %}" class="btn-action detail">
                                    <span class="material-icons">visibility</span>
                                    å±æ€§
                                </a>
                            {% endif %}

                            {% if user.username in locked_usernames %}
                                <form method="post" action="{% url 'clubs:unlock_account' user.username %}" style="display:inline">{% csrf_token %}
                                    <button class="btn-action review" title="è§£é”">
                                        <span class="material-icons">lock_open</span>
                                        è§£é”
                                    </button>
                                </form>
                            {% endif %}



                            <a href="{% url 'clubs:admin_edit_user_account' user.id %}" class="btn-action detail">
                                <span class="material-icons">visibility</span>
                                è¯¦æƒ…
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <span class="material-icons">search_off</span>
        <p>æœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·</p>
    </div>
    {% endif %}
</div>

{% endblock %}
