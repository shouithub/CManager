{% extends 'clubs/base.html' %}
{% load static %}

{% block title %}
{% if current_tab == 'annual_review' %}年审记录
{% elif current_tab == 'registration' %}社团注册
{% elif current_tab == 'application' %}社团申请
{% elif current_tab == 'reimbursement' %}报销记录
{% elif current_tab == 'activity_application' %}活动申请
{% elif current_tab == 'president_transition' %}社长换届
{% endif %} - 审批中心
{% endblock %}

{% block extra_css %}
<style>
    /* 基础容器 */
    .approval-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--md3-spacing-2xl);
        padding-bottom: calc(var(--md3-spacing-2xl) + 80px); /* 增加底部padding防止被底部导航栏遮挡 */
    }

    /* 页面标题 */
    .page-header {
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-lg);
        margin-bottom: var(--md3-spacing-2xl);
        padding: var(--md3-spacing-xl);
        background: var(--md3-surface-container-low);
        border-radius: var(--md3-radius-xl);
        border: 1px solid var(--md3-outline-variant);
    }

    .page-header .material-icons {
        font-size: 2.5rem;
        color: var(--md3-primary);
    }

    .page-header-content {
        flex: 1;
    }

    .page-header h1 {
        margin: 0 0 var(--md3-spacing-xs) 0;
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--md3-on-surface);
    }

    .page-header .subtitle {
        color: var(--md3-on-surface-variant);
        font-size: 0.875rem;
    }

    /* 内容卡片 */
    .content-card {
        background: var(--md3-surface-container);
        border-radius: var(--md3-radius-xl);
        border: 1px solid var(--md3-outline-variant);
        overflow: hidden;
        box-shadow: var(--md3-elevation-1);
    }

    /* 分区标题 */
    .section-header {
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-md);
        padding: var(--md3-spacing-xl);
        background: var(--md3-surface-container-high);
        border-bottom: 1px solid var(--md3-outline-variant);
    }

    .section-header .material-icons {
        font-size: 1.5rem;
        color: var(--md3-primary);
    }

    .section-header h2 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--md3-on-surface);
        flex: 1;
    }

    .section-header .badge {
        background: var(--md3-primary-container);
        color: var(--md3-on-primary-container);
        padding: var(--md3-spacing-xs) var(--md3-spacing-md);
        border-radius: var(--md3-radius-full);
        font-size: 0.875rem;
        font-weight: 600;
    }

    /* 记录部分 */
    .records-section {
        padding: var(--md3-spacing-xl);
    }

    .records-section + .records-section {
        border-top: 2px solid var(--md3-outline-variant);
    }

    .records-section .section-title {
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-sm);
        margin-bottom: var(--md3-spacing-lg);
        padding-bottom: var(--md3-spacing-md);
        border-bottom: 1px solid var(--md3-outline-variant);
    }

    .records-section .section-title .material-icons {
        font-size: 1.25rem;
        color: var(--md3-primary);
    }

    .records-section .section-title h3 {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
        color: var(--md3-on-surface);
        flex: 1;
    }

    .records-section .section-title .count {
        font-size: 0.875rem;
        color: var(--md3-on-surface-variant);
    }

    /* 记录列表 */
    .records-list {
        display: flex;
        flex-direction: column;
        gap: var(--md3-spacing-md);
    }

    .record-card {
        background: var(--md3-surface-container-highest);
        border: 1px solid var(--md3-outline-variant);
        border-radius: var(--md3-radius-lg);
        padding: var(--md3-spacing-lg);
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .record-card:hover {
        background: var(--md3-surface-container-high);
        border-color: var(--md3-primary);
        box-shadow: var(--md3-elevation-2);
        transform: translateY(-2px);
    }

    .record-card-header {
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-md);
        margin-bottom: var(--md3-spacing-md);
    }

    .record-card-header .club-name {
        font-size: 1rem;
        font-weight: 600;
        color: var(--md3-on-surface);
        flex: 1;
    }

    .record-card-body {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: var(--md3-spacing-md);
        margin-bottom: var(--md3-spacing-md);
    }

    .record-field {
        display: flex;
        flex-direction: column;
        gap: var(--md3-spacing-xs);
    }

    .record-field-label {
        font-size: 0.75rem;
        color: var(--md3-on-surface-variant);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .record-field-value {
        font-size: 0.875rem;
        color: var(--md3-on-surface);
        font-weight: 500;
    }

    .record-card-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--md3-spacing-md);
        padding-top: var(--md3-spacing-md);
        border-top: 1px solid var(--md3-outline-variant);
    }

    /* 状态徽章 */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--md3-spacing-xs);
        padding: var(--md3-spacing-xs) var(--md3-spacing-md);
        border-radius: var(--md3-radius-full);
        font-size: 0.875rem;
        font-weight: 600;
        white-space: nowrap;
    }

    .status-badge .material-icons {
        font-size: 1rem;
    }

    .status-badge.approved {
        background: var(--md3-tertiary-container);
        color: var(--md3-on-tertiary-container);
    }

    .status-badge.rejected {
        background: var(--md3-error-container);
        color: var(--md3-on-error-container);
    }

    .status-badge.pending {
        background: var(--md3-secondary-container);
        color: var(--md3-on-secondary-container);
    }

    .status-badge.partially-rejected {
        background: var(--md3-surface-container-highest);
        color: var(--md3-on-surface);
        border: 1px solid var(--md3-outline);
    }

    /* 操作按钮 */
    .action-btn {
        display: inline-flex;
        align-items: center;
        gap: var(--md3-spacing-xs);
        padding: var(--md3-spacing-sm) var(--md3-spacing-md);
        border-radius: var(--md3-radius-full);
        font-size: 0.875rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s ease;
        border: 1px solid transparent;
    }

    .action-btn.primary {
        background: var(--md3-primary);
        color: var(--md3-on-primary);
    }

    .action-btn.primary:hover {
        background: var(--md3-primary-hover);
        box-shadow: var(--md3-elevation-2);
    }

    .action-btn .material-icons {
        font-size: 1.125rem;
    }

    /* 空状态 */
    .empty-state {
        text-align: center;
        padding: var(--md3-spacing-3xl);
        color: var(--md3-on-surface-variant);
    }

    .empty-state-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto var(--md3-spacing-lg);
        background: var(--md3-surface-container-highest);
        border-radius: var(--md3-radius-full);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .empty-state-icon .material-icons {
        font-size: 2.5rem;
        color: var(--md3-on-surface-variant);
        opacity: 0.5;
    }

    .empty-state h3 {
        margin: 0 0 var(--md3-spacing-sm) 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--md3-on-surface);
    }

    .empty-state p {
        margin: 0;
        font-size: 0.875rem;
    }

    /* 移动端响应式 */
    @media (max-width: 768px) {
        .approval-container {
            padding: var(--md3-spacing-lg);
        }

        .page-header {
            padding: var(--md3-spacing-lg);
            border-radius: var(--md3-radius-lg);
        }

        .page-header .material-icons {
            font-size: 2rem;
        }

        .page-header h1 {
            font-size: 1.25rem;
        }

        .records-section {
            padding: var(--md3-spacing-lg);
        }

        .record-card {
            padding: var(--md3-spacing-md);
        }

        .record-card-body {
            grid-template-columns: 1fr;
        }
    }
</style>

<!-- 移动端自动切换到移动版 -->
<script>
function checkLayout() {
    if (window.innerWidth <= 768) {
        window.location.href = '{% url "clubs:approval_center_mobile" %}';
    }
}
// 初始检测
checkLayout();
// 监听窗口大小变化
window.addEventListener('resize', checkLayout);
</script>

{% endblock %}

{% block content %}
<div class="approval-container">
    <!-- 页面标题 -->
    <div class="page-header">
        {% if current_tab == 'annual_review' %}
        <span class="material-icons">assignment</span>
        <div class="page-header-content">
            <h1>年审记录</h1>
            <p class="subtitle">查看和管理社团年审提交记录</p>
        </div>
        {% elif current_tab == 'registration' %}
        <span class="material-icons">add_circle</span>
        <div class="page-header-content">
            <h1>社团注册</h1>
            <p class="subtitle">查看社团注册申请和审核状态</p>
        </div>
        {% elif current_tab == 'application' %}
        <span class="material-icons">create</span>
        <div class="page-header-content">
            <h1>社团申请</h1>
            <p class="subtitle">查看新社团创建申请记录</p>
        </div>
        {% elif current_tab == 'reimbursement' %}
        <span class="material-icons">receipt</span>
        <div class="page-header-content">
            <h1>报销记录</h1>
            <p class="subtitle">查看社团费用报销申请</p>
        </div>
        {% elif current_tab == 'activity_application' %}
        <span class="material-icons">event</span>
        <div class="page-header-content">
            <h1>活动申请</h1>
            <p class="subtitle">查看社团活动申请和审批</p>
        </div>
        {% elif current_tab == 'president_transition' %}
        <span class="material-icons">swap_horiz</span>
        <div class="page-header-content">
            <h1>社长换届</h1>
            <p class="subtitle">查看社长换届申请记录</p>
        </div>
        {% endif %}
    </div>

    <!-- 内容卡片 -->
    <div class="content-card">
        <!-- 活跃的记录（待审核/已拒绝） -->
        <div class="records-section">
            <div class="section-title">
                <span class="material-icons">notifications_active</span>
                <h3>当前活跃</h3>
                <span class="count">{{ active_items|length }} 条记录</span>
            </div>
            
            {% if active_items %}
            <div class="records-list">
                {% for item in active_items %}
                <div class="record-card" onclick="window.location.href='/clubs/approval-center-detail/{{ current_tab }}/{{ item.id }}/';">
                    <div class="record-card-header">
                        {% if current_tab == 'annual_review' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'registration' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'application' %}
                        <span class="club-name">{{ item.club_name }}</span>
                        {% elif current_tab == 'reimbursement' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'activity_application' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'president_transition' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% endif %}
                        
                        {% if item.status == 'pending' %}
                        <span class="status-badge pending">
                            <span class="material-icons">schedule</span> 待审核
                        </span>
                        {% elif item.status == 'rejected' %}
                        <span class="status-badge rejected">
                            <span class="material-icons">cancel</span> 已拒绝
                        </span>
                        {% elif item.status == 'partially_rejected' %}
                        <span class="status-badge partially-rejected">
                            <span class="material-icons">error</span> 部分拒绝
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="record-card-body">
                        {% if current_tab == 'annual_review' %}
                        <div class="record-field">
                            <span class="record-field-label">年份</span>
                            <span class="record-field-value">{{ item.submission_year }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'registration' %}
                        <div class="record-field">
                            <span class="record-field-label">注册期</span>
                            <span class="record-field-value">{{ item.registration_period.name }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'application' %}
                        <div class="record-field">
                            <span class="record-field-label">申请人</span>
                            <span class="record-field-value">{{ item.requested_by.get_full_name|default:item.requested_by.username }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'reimbursement' %}
                        <div class="record-field">
                            <span class="record-field-label">报销金额</span>
                            <span class="record-field-value" style="color: var(--md3-primary); font-weight: 600;">¥{{ item.reimbursement_amount|floatformat:2 }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'activity_application' %}
                        <div class="record-field">
                            <span class="record-field-label">活动日期</span>
                            <span class="record-field-value">{{ item.activity_date|date:"Y-m-d" }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'president_transition' %}
                        <div class="record-field">
                            <span class="record-field-label">新社长</span>
                            <span class="record-field-value">{{ item.new_president_name }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if item.status == 'rejected' and not item.has_newer_version %}
                    <div class="record-card-footer">
                        {% if current_tab == 'annual_review' %}
                        <a href="{% url 'clubs:edit_rejected_review' item.club.id %}?type=review&request_id={{ item.id }}" 
                           class="action-btn primary" onclick="event.stopPropagation()">
                            <span class="material-icons">edit</span> 修改材料
                        </a>
                        {% elif current_tab == 'registration' %}
                        <a href="{% url 'clubs:edit_rejected_review' club_id=item.club.id %}?type=club_registration&request_id={{ item.id }}" 
                           class="action-btn primary" onclick="event.stopPropagation()">
                            <span class="material-icons">edit</span> 修改材料
                        </a>
                        {% elif current_tab == 'application' %}
                        <a href="{% url 'clubs:edit_rejected_review' club_id=item.id %}?type=club_application&request_id={{ item.id }}" 
                           class="action-btn primary" onclick="event.stopPropagation()">
                            <span class="material-icons">edit</span> 修改材料
                        </a>
                        {% elif current_tab == 'reimbursement' %}
                        <a href="{% url 'clubs:edit_rejected_review' club_id=item.club.id %}?type=reimbursement&request_id={{ item.id }}" 
                           class="action-btn primary" onclick="event.stopPropagation()">
                            <span class="material-icons">edit</span> 修改材料
                        </a>
                        {% elif current_tab == 'activity_application' %}
                        <a href="{% url 'clubs:edit_rejected_review' club_id=item.club.id %}?type=activity_application&request_id={{ item.id }}" 
                           class="action-btn primary" onclick="event.stopPropagation()">
                            <span class="material-icons">edit</span> 修改材料
                        </a>
                        {% elif current_tab == 'president_transition' %}
                        <a href="{% url 'clubs:edit_rejected_review' club_id=item.club.id %}?type=president_transition&request_id={{ item.id }}" 
                           class="action-btn primary" onclick="event.stopPropagation()">
                            <span class="material-icons">edit</span> 修改材料
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    <span class="material-icons">check_circle</span>
                </div>
                <h3>暂无活跃记录</h3>
                <p>当前没有待处理或已拒绝的申请</p>
            </div>
            {% endif %}
        </div>

        <!-- 已完成的记录（已通过） -->
        <div class="records-section">
            <div class="section-title">
                <span class="material-icons">done_all</span>
                <h3>已通过记录</h3>
                <span class="count">{{ completed_items|length }} 条记录</span>
            </div>
            
            {% if completed_items %}
            <div class="records-list">
                {% for item in completed_items|slice:":3" %}
                <div class="record-card" onclick="window.location.href='/clubs/approval-center-detail/{{ current_tab }}/{{ item.id }}/';">
                    <div class="record-card-header">
                        {% if current_tab == 'annual_review' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'registration' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'application' %}
                        <span class="club-name">{{ item.club_name }}</span>
                        {% elif current_tab == 'reimbursement' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'activity_application' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'president_transition' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% endif %}
                        
                        <span class="status-badge approved">
                            <span class="material-icons">check_circle</span> 已批准
                        </span>
                    </div>
                    
                    <div class="record-card-body">
                        {% if current_tab == 'annual_review' %}
                        <div class="record-field">
                            <span class="record-field-label">年份</span>
                            <span class="record-field-value">{{ item.submission_year }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'registration' %}
                        <div class="record-field">
                            <span class="record-field-label">注册期</span>
                            <span class="record-field-value">{{ item.registration_period.name }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'application' %}
                        <div class="record-field">
                            <span class="record-field-label">申请人</span>
                            <span class="record-field-value">{{ item.requested_by.get_full_name|default:item.requested_by.username }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'reimbursement' %}
                        <div class="record-field">
                            <span class="record-field-label">报销金额</span>
                            <span class="record-field-value" style="color: var(--md3-primary); font-weight: 600;">¥{{ item.reimbursement_amount|floatformat:2 }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'activity_application' %}
                        <div class="record-field">
                            <span class="record-field-label">活动日期</span>
                            <span class="record-field-value">{{ item.activity_date|date:"Y-m-d" }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'president_transition' %}
                        <div class="record-field">
                            <span class="record-field-label">新社长</span>
                            <span class="record-field-value">{{ item.new_president_name }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if completed_items|length > 3 %}
            <div style="margin-top: var(--md3-spacing-lg); text-align: center;">
                <button onclick="openHistoryModal()" class="btn btn-secondary" style="border-radius: 20px; padding: 8px 24px;">
                    查看更多历史记录
                </button>
            </div>
            {% endif %}

            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    <span class="material-icons">inbox</span>
                </div>
                <h3>暂无已通过记录</h3>
                <p>还没有审批通过的申请</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- 历史记录弹窗 -->
<div id="historyModal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">history</span>全部已通过记录</h2>
            <button onclick="closeHistoryModal()" class="modal-close">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="records-list">
                {% for item in completed_items %}
                <div class="record-card" onclick="window.location.href='/clubs/approval-center-detail/{{ current_tab }}/{{ item.id }}/';">
                    <div class="record-card-header">
                        {% if current_tab == 'annual_review' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'registration' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'application' %}
                        <span class="club-name">{{ item.club_name }}</span>
                        {% elif current_tab == 'reimbursement' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'activity_application' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% elif current_tab == 'president_transition' %}
                        <span class="club-name">{{ item.club.name }}</span>
                        {% endif %}
                        
                        <span class="status-badge approved">
                            <span class="material-icons">check_circle</span> 已批准
                        </span>
                    </div>
                    
                    <div class="record-card-body">
                        {% if current_tab == 'annual_review' %}
                        <div class="record-field">
                            <span class="record-field-label">年份</span>
                            <span class="record-field-value">{{ item.submission_year }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'registration' %}
                        <div class="record-field">
                            <span class="record-field-label">注册期</span>
                            <span class="record-field-value">{{ item.registration_period.name }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'application' %}
                        <div class="record-field">
                            <span class="record-field-label">申请人</span>
                            <span class="record-field-value">{{ item.requested_by.get_full_name|default:item.requested_by.username }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'reimbursement' %}
                        <div class="record-field">
                            <span class="record-field-label">报销金额</span>
                            <span class="record-field-value" style="color: var(--md3-primary); font-weight: 600;">¥{{ item.reimbursement_amount|floatformat:2 }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'activity_application' %}
                        <div class="record-field">
                            <span class="record-field-label">活动日期</span>
                            <span class="record-field-value">{{ item.activity_date|date:"Y-m-d" }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        
                        {% elif current_tab == 'president_transition' %}
                        <div class="record-field">
                            <span class="record-field-label">新社长</span>
                            <span class="record-field-value">{{ item.new_president_name }}</span>
                        </div>
                        <div class="record-field">
                            <span class="record-field-label">提交时间</span>
                            <span class="record-field-value">{{ item.submitted_at|date:"Y-m-d H:i" }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="modal-footer">
            <button onclick="closeHistoryModal()" class="btn btn-secondary">关闭</button>
        </div>
    </div>
</div>

<script>
    function openHistoryModal() {
        document.getElementById('historyModal').style.display = 'flex';
    }

    function closeHistoryModal() {
        document.getElementById('historyModal').style.display = 'none';
    }

    // 点击遮罩层关闭
    document.getElementById('historyModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeHistoryModal();
        }
    });
</script>
{% endblock %}
