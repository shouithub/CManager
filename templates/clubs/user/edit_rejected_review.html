{% extends 'clubs/base.html' %}
{% load static %}

{% block title %}ä¿®æ”¹è¢«æ‹’ææ–™{% endblock %}

{% block extra_css %}
<style>
    .edit-rejected-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--md3-spacing-2xl);
        box-sizing: border-box;
        overflow-x: hidden;
    }
    
    /* é¡µé¢æ ‡é¢˜ */
    .page-header {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        justify-content: flex-start !important;
        gap: var(--md3-spacing-md);
        margin-bottom: var(--md3-spacing-2xl);
        width: 100%;
    }
    
    .page-header .material-icons {
        font-size: 2.5rem;
        color: var(--md3-primary);
        flex-shrink: 0;
        display: inline-block !important;
    }
    
    .page-header h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 600;
        color: var(--md3-on-surface);
        white-space: nowrap !important;
        writing-mode: horizontal-tb !important;
        text-orientation: mixed;
        display: inline-block !important;
    }
    
    .content-card {
        background: var(--md3-surface-container);
        border-radius: var(--md3-radius-xl);
        padding: var(--md3-spacing-2xl);
        margin-bottom: var(--md3-spacing-xl);
        border: 1px solid var(--md3-outline-variant);
    }
    
    .notice {
        padding: var(--md3-spacing-xl);
        border-radius: var(--md3-radius-lg);
        margin-bottom: var(--md3-spacing-xl);
        border-left: 4px solid;
    }
    
    .notice.info {
        background: var(--md3-primary-container);
        border-color: var(--md3-primary);
        color: var(--md3-on-primary-container);
    }
    
    .notice.warning {
        background: #fff3cd;
        border-color: #ffc107;
        color: #856404;
    }
    
    .notice.error {
        background: var(--md3-error-container);
        border-color: var(--md3-error);
        color: var(--md3-on-error-container);
    }
    
    .notice.success {
        background: var(--md3-success-container);
        border-color: var(--md3-success);
        color: var(--md3-on-success-container);
    }
    
    .notice h5 {
        margin: 0 0 var(--md3-spacing-md) 0;
        font-size: 1.125rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-sm);
    }
    
    .notice h5 .material-icons {
        font-size: 1.25rem;
    }
    
    .notice ul {
        margin: var(--md3-spacing-md) 0 0 0;
        padding-left: var(--md3-spacing-xl);
    }
    
    .notice li {
        margin-bottom: var(--md3-spacing-sm);
    }
    
    .form-section {
        margin-bottom: var(--md3-spacing-2xl);
    }
    
    .form-section h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--md3-on-surface);
        margin-bottom: var(--md3-spacing-lg);
        display: flex;
        align-items: center;
        gap: var(--md3-spacing-sm);
    }
    
    .form-group {
        margin-bottom: var(--md3-spacing-xl);
    }
    
    .form-group label {
        display: block;
        font-weight: 500;
        color: var(--md3-on-surface);
        margin-bottom: var(--md3-spacing-sm);
        font-size: 1rem;
    }
    
    .form-group .required,
    .form-group label span[style*="color: var(--md3-error)"] {
        color: var(--md3-error);
    }
    
    .file-input-wrapper {
        position: relative;
    }
    
    .form-group input[type="file"] {
        width: 100%;
        padding: var(--md3-spacing-md);
        border: 2px dashed var(--md3-outline);
        border-radius: var(--md3-radius-md);
        background: var(--md3-surface-container-highest);
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: var(--md3-font-family-plain);
        color: var(--md3-on-surface);
    }
    
    .form-group input[type="file"]:hover {
        border-color: var(--md3-primary);
        background: var(--md3-surface-container-high);
    }
    
    .form-group input[type="file"]:focus {
        outline: 2px solid var(--md3-primary);
        outline-offset: 2px;
    }
    
    .form-group small,
    .file-hint {
        display: block;
        font-size: 0.875rem;
        color: var(--md3-on-surface-variant);
        margin-top: var(--md3-spacing-xs);
    }
    
    .form-group small a {
        color: var(--md3-primary);
        text-decoration: none;
    }
    
    .form-group small a:hover {
        text-decoration: underline;
    }
    
    .file-selected {
        color: var(--md3-primary) !important;
        font-weight: 500;
    }
    
    .template-download-box {
        background: var(--md3-secondary-container);
        padding: var(--md3-spacing-lg);
        border-radius: var(--md3-radius-md);
        margin-bottom: var(--md3-spacing-xl);
    }
    
    .template-download-box h5 {
        margin: 0 0 var(--md3-spacing-md) 0;
        font-weight: 600;
        color: var(--md3-on-secondary-container);
    }
    
    .template-download-box ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .template-download-box li {
        padding: var(--md3-spacing-sm) 0;
    }
    
    .template-download-box a {
        color: var(--md3-primary);
        text-decoration: none;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: var(--md3-spacing-xs);
    }
    
    .template-download-box a:hover {
        text-decoration: underline;
    }
    
    .btn-group {
        display: flex;
        gap: var(--md3-spacing-md);
        margin-top: var(--md3-spacing-2xl);
    }
    
    @media (max-width: 768px) {
        .edit-rejected-container {
            padding: var(--md3-spacing-lg);
            overflow-x: hidden;
        }
        
        .page-header {
            flex-direction: row !important;
            justify-content: flex-start !important;
            margin-bottom: var(--md3-spacing-lg);
            width: 100%;
        }
        
        .page-header .material-icons {
            font-size: 2rem;
        }
        
        .page-header h1 {
            font-size: 1.25rem;
            white-space: nowrap !important;
            writing-mode: horizontal-tb !important;
        }
        
        .content-card {
            padding: var(--md3-spacing-lg);
            overflow-x: hidden;
        }
        
        .btn-group {
            flex-direction: column;
        }
        
        .btn-group .btn {
            width: 100%;
        }
    }
</style>

<script>
    // æ–‡ä»¶è¾“å…¥æ¡†å˜åŒ–æ—¶æ˜¾ç¤ºæ–‡ä»¶å
    document.addEventListener('DOMContentLoaded', function() {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        fileInputs.forEach(function(input) {
            input.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    const fileName = file.name;
                    const fileSize = (file.size / 1024).toFixed(1);
                    
                    // æŸ¥æ‰¾å…³è”çš„ small å…ƒç´ å¹¶æ›´æ–°æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                    const smallElement = this.nextElementSibling;
                    if (smallElement && smallElement.tagName === 'SMALL') {
                        const originalText = smallElement.textContent;
                        smallElement.innerHTML = `<span class="file-selected">âœ“ å·²é€‰æ‹©: ${fileName} (${fileSize} KB)</span>`;
                        
                        // ä¿å­˜åŸå§‹æ–‡æœ¬ä»¥å¤‡åç”¨
                        if (!smallElement.dataset.originalText) {
                            smallElement.dataset.originalText = originalText;
                        }
                    }
                }
            });
        });
    });
</script>
{% endblock %}

{% block content %}

<script>
    // æ–‡ä»¶è¾“å…¥æ¡†å˜åŒ–æ—¶æ˜¾ç¤ºæ–‡ä»¶å
    document.addEventListener('DOMContentLoaded', function() {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        fileInputs.forEach(function(input) {
            input.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    const fileName = file.name;
                    const fileSize = (file.size / 1024).toFixed(1);
                    
                    // æŸ¥æ‰¾å…³è”çš„ small å…ƒç´ å¹¶æ›´æ–°æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                    const smallElement = this.nextElementSibling;
                    if (smallElement && smallElement.tagName === 'SMALL') {
                        const originalText = smallElement.textContent;
                        smallElement.innerHTML = `<span style="color: var(--md3-primary);">âœ“ å·²é€‰æ‹©: ${fileName} (${fileSize} KB)</span>`;
                        
                        // ä¿å­˜åŸå§‹æ–‡æœ¬ä»¥å¤‡åç”¨
                        if (!smallElement.dataset.originalText) {
                            smallElement.dataset.originalText = originalText;
                        }
                    }
                }
            });
        });
    });
</script>

<div class="edit-rejected-container">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
        <span class="material-icons">edit</span>
        <h1>ä¿®æ”¹è¢«æ‹’ææ–™</h1>
    </div>
    
    <div class="content-card">
                    <!-- é”™è¯¯æç¤º -->
                    {% if messages %}
                        {% for message in messages %}
                            <div class="message {% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% else %}info{% endif %}">
                                <div>{{ message }}</div>
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                    <!-- è¡¨å•éªŒè¯é”™è¯¯ -->
                    {% if errors %}
                        <div class="message error">
                            <div>
                                <strong>æäº¤å¤±è´¥ï¼š</strong>
                                <ul>
                                    {% for error in errors %}
                                        <li>{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    {% endif %}

                    <!-- é‡æ–°æäº¤è¯´æ˜ -->
                    {% if review_type == 'club_registration' %}
                        <div class="notice info">
                            <div>
                                <h5>é‡æ–°æäº¤è¯´æ˜</h5>
                                <p>æ‚¨çš„æ³¨å†Œç”³è¯·ä¸­æœ‰éƒ¨åˆ†å†…å®¹éœ€è¦ä¿®æ”¹ï¼Œè¯·æ ¹æ®å®¡æ ¸æ„è§é‡æ–°ä¸Šä¼ ä»¥ä¸‹ææ–™ï¼š</p>
                                {% if registration.status == 'partially_rejected' %}
                                    <p><strong>æç¤ºï¼šæ‚¨åªéœ€è¦é‡æ–°ä¸Šä¼ è¢«æ‹’ç»çš„ææ–™ã€‚</strong></p>
                                {% else %}
                                    <p><strong>æ³¨æ„ï¼šæ‰€æœ‰å¿…å¡«ææ–™å¿…é¡»ä¸Šä¼ ï¼Œå¦åˆ™ç”³è¯·å°†è¢«æ‹’ç»ã€‚</strong></p>
                                {% endif %}
                                <p><strong>æ–‡ä»¶æ ¼å¼è¦æ±‚ï¼šæ‰€æœ‰æ–‡ä»¶å¿…é¡»ä¸ºWordæ ¼å¼(.docæˆ–.docx)ã€‚</strong></p>
                            </div>
                        </div>
                    {% elif review_type == 'application' %}
                        <div class="notice warning">
                            <div>
                                <strong>æ³¨æ„ï¼š</strong>æ‚¨çš„ç¤¾å›¢ç”³è¯·è¢«æ‹’ç»ï¼Œè¯·æ ¹æ®å®¡æ ¸æ„è§ä¿®æ”¹å¹¶é‡æ–°æäº¤ææ–™ã€‚
                            </div>
                        </div>
                    {% else %}
                        <div class="notice warning">
                            <div>
                                <strong>æ³¨æ„ï¼š</strong>è¯·ä¿®æ”¹ä»¥ä¸‹è¢«æ‹’ç»çš„ææ–™ï¼Œä¿®æ”¹å®Œæˆåç‚¹å‡»"æäº¤å®¡æ ¸"æŒ‰é’®é‡æ–°æäº¤ã€‚
                            </div>
                        </div>
                    {% endif %}
                    
                    <!-- æ¨¡æ¿ä¸‹è½½æç¤º -->
                    {% if review_type == 'club_registration' and registration_templates %}
                    <div class="template-download-box">
                        <h5>ğŸ“„ å¯ç”¨æ¨¡æ¿</h5>
                        <ul>
                            {% for template in registration_templates %}
                                <li>
                                    <a href="{{ template.file.url }}" download>
                                        {{ template.name }}
                                    </a>
                                    {% if template.description %} - <small>{{ template.description }}</small>{% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% elif review_type == 'review' %}

                    {% endif %}
                    
                    <!-- ç”³è¯·ä¿¡æ¯ -->
                    {% if review_type == 'application' %}
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">ç”³è¯·ä¿¡æ¯</h5>
                            <p><strong>ç¤¾å›¢åç§°:</strong> {{ application.club_name }}</p>
                            <p><strong>æäº¤æ—¶é—´:</strong> {{ application.created_at|date:"Y-m-d H:i" }}</p>
                            <p><strong>å®¡æ ¸çŠ¶æ€:</strong> 
                                <span class="badge badge-danger" style="border: 1px solid #dc3545;">å·²æ‹’ç»</span>
                            </p>
                            <p><strong>å®¡æ ¸æ„è§:</strong> {{ application.reviewer_comment }}</p>
                        </div>
                    </div>
                    {% elif review_type == 'club_registration' %}
                    <div class="mb-5 mt-5 py-4">
                        <div class="card shadow-md border border-secondary">
                            <div class="card-header bg-white">
                                <h2 class="h5 mb-0 font-weight-bold text-secondary">
                                    â„¹ï¸ ç”³è¯·ä¿¡æ¯
                                </h2>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3 p-2 bg-light rounded">
                                            <strong>æäº¤æ—¶é—´:</strong> {{ registration.submitted_at|date:"Y-m-d H:i:s" }}
                                        </div>
                                        <div class="mb-3 p-2 bg-light rounded">
                                            <strong>çŠ¶æ€:</strong> 
                                            {% if registration.status == 'pending' %}
                                                <span class="badge bg-warning">å¾…å®¡æ ¸</span>
                                            {% elif registration.status == 'approved' %}
                                                <span class="badge bg-success">å·²æ‰¹å‡†</span>
                                            {% elif registration.status == 'rejected' %}
                                                <span class="badge bg-danger">å·²æ‹’ç»</span>
                                            {% elif registration.status == 'partially_rejected' %}
                                                <span class="badge bg-warning">éƒ¨åˆ†æ‹’ç»</span>
                                            {% endif %}
                                        </div>
                                        <div class="mb-3 p-2 bg-light rounded">
                                            <strong>å®¡æ ¸æ„è§:</strong> 
                                            <div class="mt-1">
                                                {{ registration.reviewer_comment|default:"æ— " }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- è¢«æ‹’ç»ææ–™åˆ—è¡¨ -->
                    {% if rejected_materials %}
                        {% if review_type == 'club_registration' %}
                            <div class="notice warning">
                                <div>
                                    <h5><span class="material-icons" style="vertical-align: middle; font-size: 1em;">warning</span> éœ€é‡æ–°æäº¤çš„ææ–™</h5>
                                    <div style="margin-top: var(--md3-spacing-md);">
                                        {% for material in rejected_materials %}
                                            <div class="badge badge-warning" style="display: block; margin-bottom: var(--md3-spacing-sm); padding: var(--md3-spacing-md); text-align: left;">
                                                {% if material == 'registration_form' %}ç¤¾å›¢æ³¨å†Œç”³è¯·è¡¨
                                                {% elif material == 'basic_info_form' %}å­¦ç”Ÿç¤¾å›¢åŸºç¡€ä¿¡æ¯è¡¨
                                                {% elif material == 'membership_fee_form' %}ä¼šè´¹è¡¨æˆ–å…æ”¶ä¼šè´¹è¯´æ˜ä¹¦
                                                {% elif material == 'leader_change_application' %}ç¤¾å›¢ä¸»è¦è´Ÿè´£äººå˜åŠ¨ç”³è¯·è¡¨
                                                {% elif material == 'meeting_minutes' %}ç¤¾å›¢å¤§ä¼šä¼šè®®è®°å½•
                                                {% elif material == 'name_change_application' %}ç¤¾å›¢åç§°å˜æ›´ç”³è¯·è¡¨
                                                {% elif material == 'advisor_change_application' %}ç¤¾å›¢æŒ‡å¯¼è€å¸ˆå˜åŠ¨ç”³è¯·è¡¨
                                                {% elif material == 'business_advisor_change_application' %}ç¤¾å›¢ä¸šåŠ¡æŒ‡å¯¼å•ä½å˜åŠ¨ç”³è¯·è¡¨
                                                {% elif material == 'new_media_application' %}æ–°åª’ä½“å¹³å°å»ºç«‹ç”³è¯·è¡¨
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% elif review_type == 'application' %}
                            <div class="notice error">
                                <div>
                                    <h5>
                                        <span class="material-icons">error</span>
                                        éœ€è¦ä¿®æ”¹çš„ææ–™
                                    </h5>
                                    <ul>
                                        {% for material in rejected_materials %}
                                            <li>
                                                {% if material == 'establishment_application' %}ç¤¾å›¢æˆç«‹ç”³è¯·ä¹¦
                                                {% elif material == 'constitution_draft' %}ç¤¾å›¢ç« ç¨‹è‰æ¡ˆ
                                                {% elif material == 'three_year_plan' %}ç¤¾å›¢ä¸‰å¹´å‘å±•è§„åˆ’
                                                {% elif material == 'leaders_resumes' %}ç¤¾å›¢æ‹Ÿä»»è´Ÿè´£äººå’ŒæŒ‡å¯¼è€å¸ˆçš„è¯¦ç»†ç®€å†å’Œèº«ä»½è¯å¤å°ä»¶
                                                {% elif material == 'one_month_activity_plan' %}ç¤¾å›¢ç»„å»ºä¸€ä¸ªæœˆåçš„æ´»åŠ¨è®¡åˆ’
                                                {% elif material == 'advisor_certificates' %}ç¤¾å›¢è€å¸ˆçš„ç›¸å…³ä¸“ä¸šè¯ä¹¦
                                                {% endif %}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% else %}
                            <div class="notice error">
                                <div>
                                    <h5>
                                        <span class="material-icons">error</span>
                                        éœ€è¦ä¿®æ”¹çš„ææ–™
                                    </h5>
                                    <ul>
                                        {% for material in rejected_materials %}
                                            <li>
                                                {% if material == 'self_assessment_form' %}<span class="material-icons" style="vertical-align: middle; font-size: 1em;">assignment</span> è‡ªæŸ¥è¡¨
                                                {% elif material == 'club_constitution' %}ğŸ“‘ ç¤¾å›¢ç« ç¨‹
                                                {% elif material == 'leader_learning_work_report' %}<span class="material-icons" style="vertical-align: middle; font-size: 1em;">person</span> è´Ÿè´£äººå­¦ä¹ åŠå·¥ä½œæƒ…å†µè¡¨
                                                {% elif material == 'annual_activity_list' %}ğŸ“… ç¤¾å›¢å¹´åº¦æ´»åŠ¨æ¸…å•
                                                {% elif material == 'advisor_performance_report' %}<span class="material-icons" style="vertical-align: middle; font-size: 1em;">school</span> æŒ‡å¯¼æ•™å¸ˆå±¥èŒæƒ…å†µè¡¨
                                                {% elif material == 'financial_report' %}<span class="material-icons" style="vertical-align: middle; font-size: 1em;">attach_money</span> å¹´åº¦è´¢åŠ¡æƒ…å†µè¡¨
                                                {% elif material == 'member_composition_list' %}<span class="material-icons" style="vertical-align: middle; font-size: 1em;">group</span> ç¤¾å›¢æˆå‘˜æ„æˆè¡¨
                                                {% elif material == 'new_media_account_report' %}ğŸ“± æ–°åª’ä½“è´¦å·åŠè¿ç»´æƒ…å†µè¡¨
                                                {% elif material == 'other_materials' %}ğŸ“¦ å…¶ä»–ææ–™
                                                {% else %}{{ material }}
                                                {% endif %}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% endif %}
                    {% else %}
                        <!-- å¦‚æœæ²¡æœ‰å…·ä½“çš„è¢«æ‹’ç»ææ–™åˆ—è¡¨ï¼Œæ˜¾ç¤ºå®¡æ ¸æ„è§ -->
                        {% if review_type == 'review' %}
                            <div class="notice warning">
                                <div>
                                    <h5>
                                        <span class="material-icons">info</span>
                                        å®¡æ ¸æ„è§
                                    </h5>
                                    {% if review_comments %}
                                        <div style="margin-top: var(--md3-spacing-md);">
                                            {% for comment in review_comments %}
                                                <div style="margin-bottom: var(--md3-spacing-md); padding: var(--md3-spacing-md); background: var(--md3-surface-container-high); border-radius: var(--md3-radius-md);">
                                                    <p style="margin: 0; white-space: pre-wrap;">{{ comment }}</p>
                                                </div>
                                            {% endfor %}
                                        </div>
                                        <p style="margin-top: var(--md3-spacing-md);"><strong>è¯·æ ¹æ®ä»¥ä¸Šå®¡æ ¸æ„è§ä¿®æ”¹ç›¸åº”çš„ææ–™å¹¶é‡æ–°ä¸Šä¼ ã€‚</strong></p>
                                    {% else %}
                                        <p style="margin-top: var(--md3-spacing-md);">æ‚¨çš„ç”³è¯·è¢«æ‹’ç»ï¼Œä½†æœªè®°å½•å…·ä½“éœ€è¦ä¿®æ”¹çš„ææ–™ã€‚å»ºè®®æ‚¨æ£€æŸ¥æ‰€æœ‰ææ–™å¹¶é‡æ–°ä¸Šä¼ ã€‚</p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}

                    <!-- å®¡æ ¸æ„è§ - æ€»æ˜¯æ˜¾ç¤º -->
                    {% if review_comments %}
                        <div class="notice info" style="margin-top: var(--md3-spacing-lg);">
                            <div>
                                <h5>
                                    <span class="material-icons">comment</span>
                                    å®¡æ ¸æ„è§
                                </h5>
                                <div style="margin-top: var(--md3-spacing-md);">
                                    {% for comment in review_comments %}
                                        <div style="margin-bottom: var(--md3-spacing-md); padding: var(--md3-spacing-md); background: var(--md3-surface-container-high); border-radius: var(--md3-radius-md); border-left: 4px solid var(--md3-primary);">
                                            <p style="margin: 0; white-space: pre-wrap; color: var(--md3-on-surface);">{{ comment }}</p>
                                        </div>
                                    {% endfor %}
                                </div>
                                <p style="margin-top: var(--md3-spacing-md); color: var(--md3-on-surface-variant);">
                                    <strong>è¯·æ ¹æ®ä»¥ä¸Šå®¡æ ¸æ„è§ä¿®æ”¹ç›¸åº”çš„ææ–™å¹¶é‡æ–°ä¸Šä¼ ã€‚</strong>
                                </p>
                            </div>
                        </div>
                    {% endif %}

                    <!-- è¡¨å• -->
                    <form method="post" action="{% url 'clubs:edit_rejected_review' club.id %}?request_id={{ request.GET.request_id }}&type={{ request.GET.type }}" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        {% if review_type == 'club_registration' %}
                        <div class="mb-5">
                            <h2 class="h5 mb-4 text-primary-color">
                                <i class="fas fa-upload text-secondary"></i> ä¸Šä¼ ææ–™
                            </h2>
                            
                            <!-- ç¤¾å›¢æ³¨å†Œç”³è¯·è¡¨ -->
                            {% if 'registration_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="registration_form">
                                        ğŸ“„ 1. ç¤¾å›¢æ³¨å†Œç”³è¯·è¡¨
                                        {% if registration.status == 'rejected' or 'registration_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="registration_form" id="registration_form" 
                                           {% if registration.status == 'rejected' or 'registration_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                            
                            <!-- å­¦ç”Ÿç¤¾å›¢åŸºç¡€ä¿¡æ¯è¡¨ -->
                            {% if 'basic_info_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="basic_info_form">
                                        <span class="material-icons" style="vertical-align: middle; font-size: 1em;">assignment</span> 2. å­¦ç”Ÿç¤¾å›¢åŸºç¡€ä¿¡æ¯è¡¨
                                        {% if registration.status == 'rejected' or 'basic_info_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="basic_info_form" id="basic_info_form" 
                                           {% if registration.status == 'rejected' or 'basic_info_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                            
                            <!-- ä¼šè´¹è¡¨æˆ–å…æ”¶ä¼šè´¹è¯´æ˜ä¹¦ -->
                            {% if 'fee_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="fee_form">
                                        <span class="material-icons" style="vertical-align: middle; font-size: 1em;">attach_money</span> 3. ä¼šè´¹è¡¨æˆ–å…æ”¶ä¼šè´¹è¯´æ˜ä¹¦
                                        {% if registration.status == 'rejected' or 'fee_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="fee_form" id="fee_form" 
                                           {% if registration.status == 'rejected' or 'fee_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                            
                            <!-- ç¤¾å›¢ä¸»è¦è´Ÿè´£äººå˜åŠ¨ç”³è¯·è¡¨ -->
                            {% if 'leader_change_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="leader_change_form">
                                        <span class="material-icons">person</span> 4. ç¤¾å›¢ä¸»è¦è´Ÿè´£äººå˜åŠ¨ç”³è¯·ï¼ˆé€‰å¡«ï¼‰
                                        {% if registration.status == 'rejected' or 'leader_change_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    {% if registration.leader_change_application %}
                                        <div style="background-color: var(--md3-surface-container); padding: var(--md3-spacing-md); border-radius: var(--md3-radius-md); margin-bottom: var(--md3-spacing-sm);">
                                            <strong>å½“å‰å·²ä¸Šä¼ :</strong> 
                                            <a href="{{ registration.leader_change_application.url }}" target="_blank">
                                                {{ registration.leader_change_application.name|cut:'club_registration/' }}
                                            </a>
                                        </div>
                                    {% endif %}
                                    <input type="file" name="leader_change_form" id="leader_change_form" 
                                           {% if registration.status == 'rejected' or 'leader_change_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                            
                            <!-- ç¤¾å›¢å¤§ä¼šä¼šè®®è®°å½• -->
                            {% if 'meeting_minutes' in rejected_materials %}
                                <div class="form-group">
                                    <label for="meeting_minutes">
                                        <span class="material-icons" style="vertical-align: middle; font-size: 1em;">edit</span> 5. ç¤¾å›¢å¤§ä¼šä¼šè®®è®°å½•ï¼ˆé€‰å¡«ï¼‰
                                        {% if registration.status == 'rejected' or 'meeting_minutes' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="meeting_minutes" id="meeting_minutes" 
                                           {% if registration.status == 'rejected' or 'meeting_minutes' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            
                            <!-- ç¤¾å›¢åç§°å˜æ›´ç”³è¯·è¡¨ -->
                            {% if 'name_change_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="name_change_form">
                                        âœï¸ 6. ç¤¾å›¢åç§°å˜æ›´ç”³è¯·è¡¨ï¼ˆé€‰å¡«ï¼‰
                                        {% if registration.status == 'rejected' or 'name_change_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="name_change_form" id="name_change_form" 
                                           {% if registration.status == 'rejected' or 'name_change_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                            
                            <!-- ç¤¾å›¢æŒ‡å¯¼è€å¸ˆå˜åŠ¨ç”³è¯·è¡¨ -->
                            {% if 'advisor_change_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="advisor_change_form">
                                        <span class="material-icons">school</span> 7. ç¤¾å›¢æŒ‡å¯¼è€å¸ˆå˜åŠ¨ç”³è¯·è¡¨ï¼ˆé€‰å¡«ï¼‰
                                        {% if registration.status == 'rejected' or 'advisor_change_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="advisor_change_form" id="advisor_change_form" 
                                           {% if registration.status == 'rejected' or 'advisor_change_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                            
                            <!-- ç¤¾å›¢ä¸šåŠ¡æŒ‡å¯¼å•ä½å˜åŠ¨ç”³è¯·è¡¨ -->
                            {% if 'business_unit_change_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="business_unit_change_form">
                                        ğŸ¢ 8. ç¤¾å›¢ä¸šåŠ¡æŒ‡å¯¼å•ä½å˜åŠ¨ç”³è¯·è¡¨ï¼ˆé€‰å¡«ï¼‰
                                        {% if registration.status == 'rejected' or 'business_unit_change_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="business_unit_change_form" id="business_unit_change_form" 
                                           {% if registration.status == 'rejected' or 'business_unit_change_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                            
                            <!-- æ–°åª’ä½“å¹³å°å»ºç«‹ç”³è¯·è¡¨ -->
                            {% if 'new_media_form' in rejected_materials %}
                                <div class="form-group">
                                    <label for="new_media_form">
                                        ğŸŒ 9. æ–°åª’ä½“å¹³å°å»ºç«‹ç”³è¯·è¡¨ï¼ˆé€‰å¡«ï¼‰
                                        {% if registration.status == 'rejected' or 'new_media_form' in rejected_materials %}<span style="color: var(--md3-error);">*</span>{% endif %}
                                    </label>
                                    <input type="file" name="new_media_form" id="new_media_form" 
                                           {% if registration.status == 'rejected' or 'new_media_form' in rejected_materials %}required{% endif %} 
                                           accept=".doc,.docx">
                                    <small>æ”¯æŒDOCã€DOCXæ ¼å¼</small>
                                </div>
                            {% endif %}
                        </div>
                        {% elif review_type == 'application' %}
                            <h5>é‡æ–°æäº¤ææ–™</h5>
                            
                            <!-- åªæ˜¾ç¤ºè¢«æ‹’ç»çš„ææ–™ -->
                            {% if 'establishment_application' in rejected_materials %}
                                    <div class="form-group">
                                        <label for="establishment_application">ğŸ“„ ç¤¾å›¢æˆç«‹ç”³è¯·ä¹¦ <span style="color: var(--md3-error);">*</span></label>
                                        <input type="file" id="establishment_application" name="establishment_application" required>
                                        <small>æ–‡ä»¶ç±»å‹æ”¯æŒï¼špdf, doc, docx</small>
                                    </div>
                                {% endif %}
                                {% if 'constitution_draft' in rejected_materials %}
                                    <div class="form-group">
                                        <label for="constitution_draft"><span class="material-icons" style="vertical-align: middle; font-size: 1em;">assignment</span> ç¤¾å›¢ç« ç¨‹è‰æ¡ˆ <span style="color: var(--md3-error);">*</span></label>
                                        <input type="file" id="constitution_draft" name="constitution_draft" required>
                                        <small>æ–‡ä»¶ç±»å‹æ”¯æŒï¼špdf, doc, docx</small>
                                    </div>
                                {% endif %}
                                {% if 'three_year_plan' in rejected_materials %}
                                    <div class="form-group">
                                        <label for="three_year_plan"><span class="material-icons">show_chart</span> ç¤¾å›¢ä¸‰å¹´å‘å±•è§„åˆ’ <span style="color: var(--md3-error);">*</span></label>
                                        <input type="file" id="three_year_plan" name="three_year_plan" required>
                                        <small>æ–‡ä»¶ç±»å‹æ”¯æŒï¼špdf, doc, docx</small>
                                    </div>
                                {% endif %}
                                {% if 'leaders_resumes' in rejected_materials %}
                                    <div class="form-group">
                                        <label for="leaders_resumes"><span class="material-icons">person</span> ç¤¾å›¢æ‹Ÿä»»è´Ÿè´£äººå’ŒæŒ‡å¯¼è€å¸ˆçš„è¯¦ç»†ç®€å†å’Œèº«ä»½è¯å¤å°ä»¶ <span style="color: var(--md3-error);">*</span></label>
                                        <input type="file" id="leaders_resumes" name="leaders_resumes" required>
                                        <small>æ–‡ä»¶ç±»å‹æ”¯æŒï¼špdf, doc, docx, jpg, jpeg, png</small>
                                    </div>
                                {% endif %}
                                {% if 'one_month_activity_plan' in rejected_materials %}
                                    <div class="form-group">
                                        <label for="one_month_activity_plan">ğŸ“… ç¤¾å›¢ç»„å»ºä¸€ä¸ªæœˆåçš„æ´»åŠ¨è®¡åˆ’ <span style="color: var(--md3-error);">*</span></label>
                                        <input type="file" id="one_month_activity_plan" name="one_month_activity_plan" required>
                                        <small>æ–‡ä»¶ç±»å‹æ”¯æŒï¼špdf, doc, docx</small>
                                    </div>
                                {% endif %}
                                {% if 'advisor_certificates' in rejected_materials %}
                                    <div class="form-group">
                                        <label for="advisor_certificates">ğŸ“ ç¤¾å›¢è€å¸ˆçš„ç›¸å…³ä¸“ä¸šè¯ä¹¦ï¼ˆå¯é€‰ï¼‰</label>
                                        <input type="file" id="advisor_certificates" name="advisor_certificates">
                                        <small>æ–‡ä»¶ç±»å‹æ”¯æŒï¼špdf, jpg, jpeg, png</small>
                                    </div>
                                {% endif %}
                        {% else %}
                            <!-- è‡ªæŸ¥è¡¨ -->
                            {% if 'self_assessment_form' in rejected_materials %}
                            <div class="form-group">
                                <label for="self_assessment_form"><span class="material-icons" style="vertical-align: middle; font-size: 1em;">assignment</span> è‡ªæŸ¥è¡¨ <span style="color: var(--md3-error);">*</span></label>
                                <input type="file" id="self_assessment_form" name="self_assessment_form" accept=".doc,.docx" required>
                                {% if rejected_submission.self_assessment_form %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.self_assessment_form.url }}" target="_blank">{{ rejected_submission.self_assessment_form.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- ç¤¾å›¢ç« ç¨‹ -->
                            {% if 'club_constitution' in rejected_materials %}
                            <div class="form-group">
                                <label for="club_constitution">ğŸ“‘ ç¤¾å›¢ç« ç¨‹ <span style="color: var(--md3-error);">*</span></label>
                                <input type="file" id="club_constitution" name="club_constitution" accept=".doc,.docx" required>
                                {% if rejected_submission.club_constitution %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.club_constitution.url }}" target="_blank">{{ rejected_submission.club_constitution.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- è´Ÿè´£äººå­¦ä¹ åŠå·¥ä½œæƒ…å†µè¡¨ -->
                            {% if 'leader_learning_work_report' in rejected_materials %}
                            <div class="form-group">
                                <label for="leader_learning_work_report"><span class="material-icons">person</span> è´Ÿè´£äººå­¦ä¹ åŠå·¥ä½œæƒ…å†µè¡¨ <span style="color: var(--md3-error);">*</span></label>
                                <input type="file" id="leader_learning_work_report" name="leader_learning_work_report" accept=".doc,.docx" required>
                                {% if rejected_submission.leader_learning_work_report %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.leader_learning_work_report.url }}" target="_blank">{{ rejected_submission.leader_learning_work_report.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- ç¤¾å›¢å¹´åº¦æ´»åŠ¨æ¸…å• -->
                            {% if 'annual_activity_list' in rejected_materials %}
                            <div class="form-group">
                                <label for="annual_activity_list">ğŸ“… ç¤¾å›¢å¹´åº¦æ´»åŠ¨æ¸…å• <span style="color: var(--md3-error);">*</span></label>
                                <input type="file" id="annual_activity_list" name="annual_activity_list" accept=".doc,.docx" required>
                                {% if rejected_submission.annual_activity_list %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.annual_activity_list.url }}" target="_blank">{{ rejected_submission.annual_activity_list.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- æŒ‡å¯¼æ•™å¸ˆå±¥èŒæƒ…å†µè¡¨ -->
                            {% if 'advisor_performance_report' in rejected_materials %}
                            <div class="form-group">
                                <label for="advisor_performance_report"><span class="material-icons">school</span> æŒ‡å¯¼æ•™å¸ˆå±¥èŒæƒ…å†µè¡¨ <span style="color: var(--md3-error);">*</span></label>
                                <input type="file" id="advisor_performance_report" name="advisor_performance_report" accept=".doc,.docx" required>
                                {% if rejected_submission.advisor_performance_report %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.advisor_performance_report.url }}" target="_blank">{{ rejected_submission.advisor_performance_report.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- å¹´åº¦è´¢åŠ¡æƒ…å†µè¡¨ -->
                            {% if 'financial_report' in rejected_materials %}
                            <div class="form-group">
                                <label for="financial_report"><span class="material-icons" style="vertical-align: middle; font-size: 1em;">attach_money</span> å¹´åº¦è´¢åŠ¡æƒ…å†µè¡¨ <span style="color: var(--md3-error);">*</span></label>
                                <input type="file" id="financial_report" name="financial_report" accept=".doc,.docx" required>
                                {% if rejected_submission.financial_report %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.financial_report.url }}" target="_blank">{{ rejected_submission.financial_report.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- ç¤¾å›¢æˆå‘˜æ„æˆè¡¨ -->
                            {% if 'member_composition_list' in rejected_materials %}
                            <div class="form-group">
                                <label for="member_composition_list"><span class="material-icons" style="vertical-align: middle; font-size: 1em;">group</span> ç¤¾å›¢æˆå‘˜æ„æˆè¡¨ <span style="color: var(--md3-error);">*</span></label>
                                <input type="file" id="member_composition_list" name="member_composition_list" accept=".doc,.docx" required>
                                {% if rejected_submission.member_composition_list %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.member_composition_list.url }}" target="_blank">{{ rejected_submission.member_composition_list.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- æ–°åª’ä½“è´¦å·åŠè¿ç»´æƒ…å†µè¡¨ -->
                            <div class="form-group">
                                <label for="new_media_account_report">ğŸ“± æ–°åª’ä½“è´¦å·åŠè¿ç»´æƒ…å†µè¡¨ <small style="color: #666;">(å¯é€‰)</small></label>
                                <input type="file" id="new_media_account_report" name="new_media_account_report" accept=".doc,.docx">
                                {% if rejected_submission.new_media_account_report %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.new_media_account_report.url }}" target="_blank">{{ rejected_submission.new_media_account_report.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx)</small>
                                {% endif %}
                            </div>

                            <!-- å…¶ä»–ææ–™ -->
                            {% if 'other_materials' in rejected_materials %}
                            <div class="form-group">
                                <label for="other_materials">ğŸ“¦ å…¶ä»–ææ–™ (å¯é€‰)</label>
                                <input type="file" id="other_materials" name="other_materials" accept=".doc,.docx">
                                {% if rejected_submission.other_materials %}
                                    <small>ç°æœ‰æ–‡ä»¶: <a href="{{ rejected_submission.other_materials.url }}" target="_blank">{{ rejected_submission.other_materials.name }}</a></small>
                                {% else %}
                                    <small>æ”¯æŒæ ¼å¼: Word (.doc, .docx) - æ­¤é¡¹å¯é€‰</small>
                                {% endif %}
                            </div>
                            {% endif %}
                        {% endif %}

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons">send</span>
                                {% if review_type == 'review' %}æäº¤å®¡æ ¸{% else %}é‡æ–°æäº¤{% endif %}
                            </button>
                            {% if review_type == 'review' %}
                                <a href="{% url 'clubs:club_detail' club.id %}" class="btn btn-outlined">
                                    <span class="material-icons">arrow_back</span>
                                    è¿”å›
                                </a>
                            {% elif review_type == 'application' %}
                                <a href="{% url 'clubs:view_club_applications' %}" class="btn btn-outlined">
                                    <span class="material-icons">arrow_back</span>
                                    è¿”å›
                                </a>
                            {% else %}
                                <a href="{% url 'clubs:club_detail' club.id %}" class="btn btn-outlined">
                                    <span class="material-icons">arrow_back</span>
                                    è¿”å›
                                </a>
                            {% endif %}
                        </div>
                    </form>
    </div>
</div>

{% endblock %}